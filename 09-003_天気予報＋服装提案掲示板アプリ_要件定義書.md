### 文書番号: 09-003

## 1. アプリ名
- アプリ名: 天気予報＋服装提案掲示板アプリ

## 2. 概要
OpenWeatherMapの天気予報APIから取得した当日の天気情報を基に、OpenAI APIで生成した服装アドバイスを含むテキストをSSD1306 OLEDディスプレイに日本語で横スクロール表示するPythonアプリケーションです。Web表示を行わず、ハードウェア上の小型ディスプレイのみで今日の天気と服装アドバイスを確認できます。

## 3. 目的
- OpenWeatherMap APIを用いたデータ取得方法を学ぶ
- OpenAI APIによる自然言語生成を理解する
- SSD1306 OLEDへの日本語テキストスクロール表示技術を理解する

## 4. 対象利用者
- プログラミング初心者
- Raspberry Pi入門者
- IoTデバイスで情報表示を学びたい学習者

## 5. システム構成
| コンポーネント                   | 役割                                    |
|----------------------------------|-----------------------------------------|
| Raspberry Pi 5                    | スクリプト実行、API呼び出し             |
| SSD1306 OLEDディスプレイ          | 天気予報・服装提案の日本語スクロール表示 |
| ネットワーク                      | 天気API通信                             |
| 天気予報API (OpenWeatherMap)      | 当日の天気情報取得                      |
| OpenAI API                        | 服装アドバイス生成                     |

## 6. ハードウェア要件
- Raspberry Pi 5本体
- microSDカード（Raspberry Pi OSインストール済み）
- SSD1306 OLEDディスプレイモジュール（I²C接続、128×64または128×32）
- I²Cレベル変換モジュール（5V OLEDの場合）
- ジャンパーワイヤ
- ブレッドボード
- 電源（公式5V電源アダプタ）

## 7. ソフトウェア要件
- OS：Raspberry Pi OS（最新推奨）
- 言語：Python 3.9以上
- ライブラリ：
  - requests（HTTP通信）
  - openai（OpenAI API クライアント）
  - luma.oled（OLED制御）
  - Pillow（画像処理・フォント描画）
  - python-dotenv（環境変数管理）
- フォント：Noto Sans CJK JP（日本語表示用）
- 参考実装:
  - [OLED日本語表示](https://github.com/Murasan201/06-004-ssd1306-oled-jp-display)
  - [OpenAI API サンプル](https://murasan-net.com/2025/03/20/openai-api-sample-2025/)

## 8. 機能要件
1. **APIキー読み込み**
   - `.env` または環境変数から `WEATHER_API_KEY` と `OPENAI_API_KEY` を取得
2. **天気情報取得**
   - OpenWeatherMap APIから当日の天気（晴れ、雨、気温など）を取得
3. **服装判定**
   - OpenAI APIを用いて、取得した天気情報（温度・天気条件）をプロンプトとして送信し、自然言語による服装アドバイスを生成
   - 生成されたアドバイスを表示用テキストに組み込む
4. **テキスト整形**
   - 天気と服装アドバイスを一連の文字列として結合
5. **OLED表示**
   - SSD1306 OLEDに日本語フォント（Noto Sans CJK JP）を使用してテキストを描画
   - 横スクロール表示でテキスト全体を表示
   - 指定回数ループ表示（デフォルト3回）
6. **定期更新**
   - 指定時間（例：毎朝8時）にのみ実行し、最新情報を表示更新

## 9. 非機能要件
- **可読性**: PEP8準拠、コメントを適切に記載
- **保守性**: 関数分割により判定ロジックを見やすく実装
- **単一ファイル完結**: 可能な限り一つのPythonファイルで実装
- **信頼性**: API通信エラー時のリトライとエラーログを実装

## 10. テスト要件
- **API取得テスト**: 無効APIキー／ネットワーク切断時のエラーハンドリング確認
- **判定ロジックテスト**: 各気温・天気パターンで正しい服装アドバイスが出力されるか検証
- **OLED表示テスト**:
  - 日本語テキストが正しく表示されるか確認
  - 異なる長さのメッセージで横スクロール動作を確認
  - フォントサイズ・スクロール速度の調整可能性を確認
- **定期実行テスト**: 指定時刻／オフセットで実行されるか確認

## 11. 受け入れ基準
1. 当日の天気と服装アドバイスがSSD1306 OLEDで日本語で正しくスクロール表示される
2. APIエラー発生時にログが出力され、次実行で回復する
3. 環境変数変更が即時反映される
4. 日本語フォントが正しく表示される  

---
以上の要件をもとに、天気予報＋服装提案掲示板アプリのプロトタイプを開発してください。
